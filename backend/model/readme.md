# `lumen2/src/model`

这里实现了光芯片的仿真模型。

`library.py`实现了一些常用的光芯片基本结构，比如微环和马赫-曾德尔干涉仪，注意这些基本结构必须是可微的，以便于`pytorch`对其进行优化。每一个结构都是一个`nn.Module`，并且至少包含以下内容：
* 接受一个或者多个输入（每一个输入都是`[batch_size, num_lambda,]`的形状，表示每一个输入端口中，接受到的在不同采样波长下的复振幅）
* 内部参数，比如耦合系数。请注意，这些参数不应该是电极电压等外部参数
* 外部参数如何影响内部参数，例如施加的电压如何影响耦合系数，我们强烈建议使用中间变量参与优化，再利用`sigmoid`函数或者类似的方法将中间变量映射到外部参数，以确保有界性。
* 给出一个或者多个输出（每一个输出都是`[batch_size, num_lambda,]`的形状，表示每一个输出端口中，给出的在不同采样波长下的复振幅）

`ensemble.py`则按照一个给定的`JSON`文件，这个文件应该规定使用哪些基本结构，各个基本结构之间如何连接，构建起整个光芯片的仿真模型，并且支持导出保存。